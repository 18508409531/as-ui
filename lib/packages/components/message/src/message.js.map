{"version":3,"file":"message.js","sources":["../../../../../../../packages/components/message/src/message.ts"],"sourcesContent":["import { createVNode, render } from 'vue'\nimport type { ComponentInternalInstance } from 'vue'\nimport type { IMessageParams } from './message.type'\nimport Message from './message.vue'\nimport { MessageContext, MessageHandler, instances } from './instance'\n\nlet seed = 1\n\nconst createMessage = (options: IMessageParams) => {\n  const id = `message_${seed++}`\n  // 渲染dom\n  const container = document.createElement('div')\n  // 用户close\n  const userOnClose = options.onClose\n  const props = {\n    ...options,\n    id,\n    onClose: () => {\n      userOnClose?.()\n      closeMessage(instance)\n    },\n    // 元素销毁\n    onDestroy: () => {\n      render(null, container)\n    }\n  }\n  // 创建虚拟节点\n  const vnode = createVNode(Message, props as any)\n  // 将虚拟节点渲染到dom\n  render(vnode, container)\n  // 挂载到body\n  document.body.appendChild(container.firstElementChild as Element)\n\n  const vm = vnode.component as ComponentInternalInstance\n\n  // 保留close关闭窗口\n  const handler: MessageHandler = {\n    close: () => {\n      // 获取组件内部属性\n      vm.exposeProxy!.visible = false\n    }\n  }\n  // 实例\n  const instance: MessageContext = {\n    id,\n    vnode,\n    vm,\n    handler,\n    props: (vnode.component as any).props\n  }\n\n  return instance\n}\n\nconst closeMessage = (instance: MessageContext) => {\n  const idx = instances.indexOf(instance)\n  if (idx === -1) return\n\n  instances.splice(idx, 1)\n  const { handler } = instance\n  handler.close()\n}\n\nexport const message = (options: IMessageParams) => {\n  const instance = createMessage(options)\n  instances.push(instance)\n  return instance.handler\n}\n\nexport default message\n"],"names":["render","createVNode","Message","instance","instances"],"mappings":";;;;;;;;AAMA,IAAI,IAAO,GAAA,CAAA,CAAA;AAEX,MAAM,aAAA,GAAgB,CAAC,OAA4B,KAAA;AACjD,EAAA,MAAM,KAAK,CAAW,QAAA,EAAA,IAAA,EAAA,CAAA,CAAA,CAAA;AAEtB,EAAM,MAAA,SAAA,GAAY,QAAS,CAAA,aAAA,CAAc,KAAK,CAAA,CAAA;AAE9C,EAAA,MAAM,cAAc,OAAQ,CAAA,OAAA,CAAA;AAC5B,EAAA,MAAM,KAAQ,GAAA;AAAA,IACZ,GAAG,OAAA;AAAA,IACH,EAAA;AAAA,IACA,SAAS,MAAM;AACb,MAAA,WAAA,IAAA,IAAA,GAAA,KAAA,CAAA,GAAA,WAAA,EAAA,CAAA;AACA,MAAA,YAAA,CAAa,QAAQ,CAAA,CAAA;AAAA,KACvB;AAAA,IAEA,WAAW,MAAM;AACf,MAAAA,UAAA,CAAO,MAAM,SAAS,CAAA,CAAA;AAAA,KACxB;AAAA,GACF,CAAA;AAEA,EAAM,MAAA,KAAA,GAAQC,eAAY,CAAAC,iBAAA,EAAS,KAAY,CAAA,CAAA;AAE/C,EAAAF,UAAA,CAAO,OAAO,SAAS,CAAA,CAAA;AAEvB,EAAS,QAAA,CAAA,IAAA,CAAK,WAAY,CAAA,SAAA,CAAU,iBAA4B,CAAA,CAAA;AAEhE,EAAA,MAAM,KAAK,KAAM,CAAA,SAAA,CAAA;AAGjB,EAAA,MAAM,OAA0B,GAAA;AAAA,IAC9B,OAAO,MAAM;AAEX,MAAA,EAAA,CAAG,YAAa,OAAU,GAAA,KAAA,CAAA;AAAA,KAC5B;AAAA,GACF,CAAA;AAEA,EAAA,MAAM,QAA2B,GAAA;AAAA,IAC/B,EAAA;AAAA,IACA,KAAA;AAAA,IACA,EAAA;AAAA,IACA,OAAA;AAAA,IACA,KAAA,EAAQ,MAAM,SAAkB,CAAA,KAAA;AAAA,GAClC,CAAA;AAEA,EAAO,OAAA,QAAA,CAAA;AACT,CAAA,CAAA;AAEA,MAAM,YAAA,GAAe,CAACG,UAA6B,KAAA;AACjD,EAAM,MAAA,GAAA,GAAMC,kBAAU,CAAA,OAAA,CAAQD,UAAQ,CAAA,CAAA;AACtC,EAAA,IAAI,GAAQ,KAAA,CAAA,CAAA;AAAI,IAAA,OAAA;AAEhB,EAAUC,kBAAA,CAAA,MAAA,CAAO,KAAK,CAAC,CAAA,CAAA;AACvB,EAAM,MAAA,EAAE,SAAY,GAAAD,UAAA,CAAA;AACpB,EAAA,OAAA,CAAQ,KAAM,EAAA,CAAA;AAChB,CAAA,CAAA;AAEa,MAAA,OAAA,GAAU,CAAC,OAA4B,KAAA;AAClD,EAAM,MAAAA,UAAA,GAAW,cAAc,OAAO,CAAA,CAAA;AACtC,EAAAC,kBAAA,CAAU,KAAKD,UAAQ,CAAA,CAAA;AACvB,EAAA,OAAOA,UAAS,CAAA,OAAA,CAAA;AAClB;;;;;"}